steps:
  - label: 'slow-ci-builds'
    trigger: cardano-node-slow-ci
    async: true
    build:
      message: "${BUILDKITE_MESSAGE}"
      commit: "${BUILDKITE_COMMIT}"
      branch: "${BUILDKITE_BRANCH}"
      env:
        BUILDKITE_PULL_REQUEST: "${BUILDKITE_PULL_REQUEST}"
        BUILDKITE_PULL_REQUEST_BASE_BRANCH: "${BUILDKITE_PULL_REQUEST_BASE_BRANCH}"
        BUILDKITE_PULL_REQUEST_REPO: "${BUILDKITE_PULL_REQUEST_REPO}"

  - label: 'check-cabal-project'
    command: 'nix-build ./nix -A iohkNix.checkCabalProject -o check-cabal-project.sh && ./check-cabal-project.sh'
    agents:
      system: x86_64-linux

# FIXME, waiting for https://github.com/input-output-hk/haskell.nix/pull/426
  - label: 'hydra-eval-errors'
    command: 'scripts/buildkite/check-hydra-eval.py'
    agents:
      system: x86_64-linux

  - label: 'stack-cabal-sync'
    command: 'nix-shell scripts/buildkite/stack-cabal-sync.nix --run scripts/buildkite/stack-cabal-sync.sh'
    agents:
      system: x86_64-linux

# FIXME:
#  - label: 'dependencies-at-master'
#    command: 'ci/check-dependencies-merged-to-master.sh'
#    agents:
#      system: x86_64-linux
